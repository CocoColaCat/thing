local a=Drawing.new("Text")
a.Visible=true
a.Text="可可競爭者自動獲勝外掛"
a.Transparency=1
a.Font=0
a.Size=25
local hue = 0
local saturation = 1
local value = 1

local function updateRainbowColor()
    hue = (hue + 0.01) % 1
    local rainbowColor = Color3.fromHSV(hue, saturation, value)
    a.Color = rainbowColor
end

game:GetService("RunService").Heartbeat:Connect(updateRainbowColor)

local replicated_storage = game:GetService("ReplicatedStorage")
local players = game:GetService("Players")
local camera = workspace.CurrentCamera
local utility = require(replicated_storage:FindFirstChild("Modules").Utility)
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local function getPlayersOrEntities()
    local entities = {}
    for _, child in ipairs(workspace:GetChildren()) do
        if child:FindFirstChildOfClass("Humanoid") then
            table.insert(entities, child)
        elseif child.Name == "HurtEffect" then
            for _, hurtPlayer in ipairs(child:GetChildren()) do
                if hurtPlayer.ClassName ~= "Highlight" then
                    table.insert(entities, hurtPlayer)
                end
            end
        end
    end
    return entities
end

local function getClosestPlayer()
    if not SilentAimEnabled then return nil end

    local closest, closestDistance = nil, math.huge
    local localPlayer = players.LocalPlayer
    local character = localPlayer.Character

    if not character then return nil end

    for _, entity in ipairs(getPlayersOrEntities()) do
        if entity == localPlayer.Character then continue end
        if not entity:FindFirstChild(aimpart) then continue end

        local position, onScreen = camera:WorldToViewportPoint(entity[aimpart].Position)
        if not onScreen then continue end 

        local center = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
        local distance = (center - Vector2.new(position.X, position.Y)).Magnitude

        if distance < closestDistance then
            closest = entity
            closestDistance = distance
        end
    end

    return closest
end

local oldRaycast = utility.Raycast
utility.Raycast = function(...)
    local arguments = { ... }

    if #arguments > 0 and arguments[4] == 999 then
        local closest = getClosestPlayer()
        if closest then
            arguments[3] = closest["Head"].Position
        end
    end

    return oldRaycast(table.unpack(arguments))
end

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

local function lookplayer()
    local closestPlayer = nil
    local closestDistance = math.huge
    
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character and otherPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - otherPlayer.Character.HumanoidRootPart.Position).Magnitude
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = otherPlayer
            end
        end
    end
    
    if closestPlayer and closestPlayer.Character and closestPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local targetCFrame = CFrame.lookAt(camera.CFrame.Position, closestPlayer.Character.HumanoidRootPart.Position)
        camera.CFrame = targetCFrame
    end
end

local player = players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- LocalScript，放在 StarterPlayer > StarterPlayerScripts
-- 按 R 鍵傳送到距離最近的玩家（不管隊伍）

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

local function teleportToNearestAlivePlayer()
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then
        warn("本地玩家角色未載入")
        return
    end
    
    local localHRP = character.HumanoidRootPart
    local localPosition = localHRP.Position
    local nearestPlayer = nil
    local nearestDistance = math.huge
    
    -- 遍歷所有玩家，找到距離最近的**活著**的玩家（排除自己）
    for _, otherPlayer in ipairs(Players:GetPlayers()) do
        if otherPlayer ~= LocalPlayer then
            local otherCharacter = otherPlayer.Character
            if otherCharacter then
                local otherHRP = otherCharacter:FindFirstChild("HumanoidRootPart")
                local otherHumanoid = otherCharacter:FindFirstChild("Humanoid")
                
                -- 檢查：有 HRP、人形、且健康值 > 0（活著）
                if otherHRP and otherHumanoid and otherHumanoid.Health > 0 then
                    local distance = (otherHRP.Position - localPosition).Magnitude
                    
                    if distance < nearestDistance then
                        nearestDistance = distance
                        nearestPlayer = otherPlayer
                    end
                end
            end
        end
    end
    
    -- 傳送
    if nearestPlayer then
        local otherHRP = nearestPlayer.Character.HumanoidRootPart
        -- offset 改成對方面向方向前方 3 studs（原版是 *3，這裡改回較安全的距離）
        local offset = otherHRP.CFrame.LookVector * 3
        localHRP.CFrame = otherHRP.CFrame + offset
        
        print("已傳送到最近活著的玩家: " .. nearestPlayer.Name .. " (距離: " .. math.floor(nearestDistance) .. " studs)")
    else
        warn("未找到其他活著的玩家")
    end
end

getgenv().AutoWinLoop = true

RunService.Heartbeat:Connect(function()
    if not getgenv().AutoWinLoop then return end
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    teleportToNearestAlivePlayer()
    lookplayer()
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
end)
